<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Agile Spin Wheel Quiz - Kahoot Style with New Player</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #1a1a2e;
    margin: 0;
    padding: 0;
    color: white;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  header {
    background: #16213e;
    padding: 15px 20px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.5);
  }
  header h1 {
    margin: 0;
    font-weight: 700;
    font-size: 2rem;
    color: #e94560;
    letter-spacing: 1.5px;
  }
  main {
    flex: 1;
    padding: 20px;
    max-width: 700px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Wheel canvas */
  #wheel {
    border-radius: 50%;
    box-shadow: 0 0 25px rgba(233, 69, 96, 0.7);
    max-width: 100%;
    height: auto;
    margin-bottom: 15px;
    background: white;
  }

  /* Buttons */
  button {
    font-weight: 700;
    cursor: pointer;
    border: none;
    border-radius: 12px;
    padding: 18px 40px;
    font-size: 1.2rem;
    margin: 10px 5px;
    transition: background-color 0.3s ease;
    outline-offset: 2px;
  }
  #spin-btn {
    background: #e94560;
    color: white;
    box-shadow: 0 5px 10px rgba(233, 69, 96, 0.7);
  }
  #spin-btn:disabled {
    background: #6f6f6f;
    box-shadow: none;
    cursor: not-allowed;
  }
  #spin-btn:hover:not(:disabled) {
    background-color: #d43452;
  }
  #play-again-btn {
    background: #0f3460;
    color: #fff;
    box-shadow: 0 5px 10px rgba(15, 52, 96, 0.7);
  }
  #play-again-btn:hover {
    background: #0a2148;
  }
  #new-player-btn {
    background: #fcd581;
    color: #0f3460;
    box-shadow: 0 5px 10px rgba(252, 213, 129, 0.8);
  }
  #new-player-btn:hover {
    background: #e6ba4b;
  }

  /* Result text */
  #result {
    font-size: 1.5rem;
    font-weight: 700;
    margin-top: 15px;
    min-height: 40px;
    text-align: center;
    color: #e94560;
  }

  /* Scoreboard */
  #scoreboard {
    margin-top: 20px;
    font-size: 1.1rem;
    font-weight: 600;
    color: #f0f0f0;
  }

  /* Modal styles */
  .modal {
    display: none;
    position: fixed; 
    z-index: 1000; 
    left: 0;
    top: 0;
    width: 100%; 
    height: 100%; 
    overflow: auto;
    background-color: rgba(26, 26, 46, 0.95);
    backdrop-filter: blur(2px);
  }
  .modal-content {
    background-color: #0f3460;
    margin: 6% auto;
    padding: 30px 40px;
    border-radius: 20px;
    width: 90%;
    max-width: 520px;
    box-shadow: 0 0 40px rgba(233, 69, 96, 0.85);
    color: white;
    display: flex;
    flex-direction: column;
  }
  .modal-content:focus {
    outline: none;
  }
  .question {
    font-size: 1.6rem;
    font-weight: 700;
    margin-bottom: 25px;
  }
  .progress {
    font-size: 1rem;
    margin-bottom: 15px;
    color: #fcd581;
  }
  .options button {
    background: #e94560;
    border: none;
    border-radius: 12px;
    padding: 15px;
    margin: 8px 0;
    font-size: 1.15rem;
    cursor: pointer;
    font-weight: 700;
    transition: background-color 0.3s ease;
    color: white;
    box-shadow: 0 3px 6px rgba(233,69,96,0.7);
  }
  .options button:hover:not(:disabled) {
    background-color: #d43452;
  }
  .options button:disabled {
    background-color: #6f6f6f;
    cursor: not-allowed;
    box-shadow: none;
  }
  .feedback {
    margin-top: 18px;
    font-weight: 700;
    font-size: 1.3rem;
    height: 36px;
  }
  #close-quiz-btn {
    align-self: flex-end;
    margin-top: 25px;
    background: #fcd581;
    color: #0f3460;
    padding: 12px 25px;
    font-weight: 700;
    font-size: 1.1rem;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(252, 213, 129, 0.8);
    transition: background-color 0.3s ease;
  }
  #close-quiz-btn:hover {
    background: #e6ba4b;
  }

  /* Name modal overrides */
  #name-modal .modal-content {
    align-items: center;
    text-align: center;
  }
  #name-modal h2 {
    font-size: 1.8rem;
    margin-bottom: 20px;
    color: #fcd581;
  }
  #player-name-input {
    width: 100%;
    max-width: 320px;
    font-size: 1.2rem;
    padding: 12px;
    border-radius: 12px;
    border: none;
    margin-bottom: 20px;
    box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
  }
  #name-submit-btn {
    background: #e94560;
    padding: 15px 40px;
    font-size: 1.3rem;
    font-weight: 700;
    border-radius: 12px;
    border: none;
    color: white;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(233,69,96,0.7);
    transition: background-color 0.3s ease;
  }
  #name-submit-btn:hover {
    background-color: #d43452;
  }
  /* Responsive */
  @media (max-width: 600px) {
    main {
      max-width: 100%;
      padding: 15px 10px;
    }
    button {
      width: 100%;
      font-size: 1.1rem;
      padding: 16px 0;
      margin: 8px 0;
    }
    #player-name-input {
      max-width: 100%;
    }
    .modal-content {
      padding: 20px 25px;
      margin-top: 20%;
    }
  }
</style>
</head>
<body>

<header>
  <h1>Agile Spin Wheel Quiz</h1>
</header>

<main>
  <canvas id="wheel" width="500" height="500" role="img" aria-label="Spin wheel with Agile quiz topics"></canvas>
  <button id="spin-btn" aria-live="polite" aria-disabled="true" disabled>Spin the Wheel!</button>
  <button id="play-again-btn" style="display:none;">Play Again</button>
  <button id="new-player-btn" style="display:none;">New Player</button>
  <div id="result" aria-live="polite" aria-atomic="true"></div>
  <div id="scoreboard" aria-live="polite" aria-atomic="true">Correct Answers: <span id="score">0</span></div>
</main>

<!-- Quiz Modal -->
<div id="quiz-modal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="quiz-title" aria-modal="true">
  <div class="modal-content" tabindex="0">
    <div class="progress" id="quiz-progress">Question 1 of 6</div>
    <div id="quiz-question" class="question" id="quiz-title"></div>
    <div class="options" id="quiz-options"></div>
    <div class="feedback" id="quiz-feedback" aria-live="assertive"></div>
    <button id="close-quiz-btn" aria-label="Close quiz modal">Close</button>
  </div>
</div>

<!-- Name Input Modal -->
<div id="name-modal" class="modal" aria-modal="true" role="dialog" aria-labelledby="name-modal-title" aria-hidden="false" style="display:block;">
  <div class="modal-content" tabindex="0" style="max-width:400px; margin:10% auto;">
    <h2 id="name-modal-title">Welcome! Please enter your name</h2>
    <input type="text" id="player-name-input" placeholder="Your name here" aria-label="Player Name" autocomplete="off" />
    <button id="name-submit-btn">Start Playing</button>
  </div>
</div>

<script>
  // Agile quiz topics/questions (6 total)
  const segments = [
    { name: 'Scrum Quiz', color: '#FF6384', question: {
      q: 'Who is responsible for maximizing the value of the product in Scrum?',
      options: ['Scrum Master', 'Product Owner', 'Development Team', 'Stakeholders'],
      answer: 1
    }},
    { name: 'Kanban Challenge', color: '#36A2EB', question: {
      q: 'What does WIP stand for in Kanban?',
      options: ['Work In Progress', 'Work Is Planned', 'Workflow In Process', 'Work Item Priority'],
      answer: 0
    }},
    { name: 'Agile Values', color: '#FFCE56', question: {
      q: 'Which is NOT one of the Agile Manifesto values?',
      options: [
        'Individuals and interactions over processes and tools',
        'Working software over comprehensive documentation',
        'Contract negotiation over customer collaboration',
        'Responding to change over following a plan'
      ],
      answer: 2
    }},
    { name: 'Retrospective Fun', color: '#9966FF', question: {
      q: 'What is the main purpose of a Sprint Retrospective?',
      options: [
        'Plan the next sprint',
        'Review the product',
        'Inspect and adapt the process',
        'Assign new tasks'
      ],
      answer: 2
    }},
    { name: 'User Story Puzzle', color: '#FF9F40', question: {
      q: 'What is the typical format of a user story?',
      options: [
        'As a [role], I want [feature] so that [benefit]',
        'When [event], then [result]',
        'Given [context], when [event], then [outcome]',
        'If [condition], then [action]'
      ],
      answer: 0
    }},
    { name: 'Agile Planning', color: '#4BC0C0', question: {
      q: 'What is a common Agile planning artifact?',
      options: [
        'Product Backlog',
        'Gantt Chart',
        'Critical Path',
        'Waterfall Model'
      ],
      answer: 0
    }},
  ];

  const canvas = document.getElementById('wheel');
  const ctx = canvas.getContext('2d');
  const numSegments = segments.length;
  const centerX = canvas.width / 2;
  const centerY = canvas.height / 2;
  const radius = 200;
  let startAngle = 0;
  const arc = 2 * Math.PI / numSegments;
  let spinTimeout = null;
  let spinAngleStart = 0;
  let spinTime = 0;
  let spinTimeTotal = 0;

  const spinBtn = document.getElementById('spin-btn');
  const playAgainBtn = document.getElementById('play-again-btn');
  const newPlayerBtn = document.getElementById('new-player-btn');
  const resultDiv = document.getElementById('result');
  const scoreSpan = document.getElementById('score');

  const quizModal = document.getElementById('quiz-modal');
  const quizQuestionDiv = document.getElementById('quiz-question');
  const quizOptionsDiv = document.getElementById('quiz-options');
  const quizFeedbackDiv = document.getElementById('quiz-feedback');
  const closeQuizBtn = document.getElementById('close-quiz-btn');
  const quizProgressDiv = document.getElementById('quiz-progress');

  const nameModal = document.getElementById('name-modal');
  const nameInput = document.getElementById('player-name-input');
  const nameSubmitBtn = document.getElementById('name-submit-btn');

  // Track user score, questions asked
  let score = 0;
  let playerName = localStorage.getItem('agilePlayerName') || '';
  let questionsAsked = new Set();
  let questionsCount = 0;
  const maxQuestions = 6;

  // --- Helper functions ---
  function drawWheel() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for(let i = 0; i < numSegments; i++) {
      let angle = startAngle + i * arc;
      ctx.fillStyle = segments[i].color;
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.arc(centerX, centerY, radius, angle, angle + arc, false);
      ctx.lineTo(centerX, centerY);
      ctx.fill();

      ctx.save();
      ctx.fillStyle = 'white';
      ctx.font = 'bold 16px Arial';
      ctx.translate(centerX + Math.cos(angle + arc/2) * radius / 1.5,
                    centerY + Math.sin(angle + arc/2) * radius / 1.5);
      ctx.rotate(angle + arc/2 + Math.PI/2);
      const text = segments[i].name;
      ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
      ctx.restore();
    }
    // Center circle
    ctx.beginPath();
    ctx.arc(centerX, centerY, 50, 0, 2 * Math.PI);
    ctx.fillStyle = '#16213e';
    ctx.fill();

    // Arrow pointer
    ctx.fillStyle = '#e94560';
    ctx.beginPath();
    ctx.moveTo(centerX - 15, centerY - (radius + 10));
    ctx.lineTo(centerX + 15, centerY - (radius + 10));
    ctx.lineTo(centerX, centerY - (radius - 10));
    ctx.closePath();
    ctx.fill();
  }

  function easeOut(t, b, c, d) {
    t /= d;
    t--;
    return c*(t*t*t + 1) + b;
  }

  // --- Spin logic ---
  function spin() {
    if(questionsAsked.size >= maxQuestions) {
      alert(`You answered all ${maxQuestions} questions! Thanks, ${playerName}.`);
      spinBtn.disabled = true;
      spinBtn.setAttribute('aria-disabled', 'true');
      playAgainBtn.style.display = 'inline-block';
      newPlayerBtn.style.display = 'inline-block';
      resultDiv.textContent = `Game over! You scored ${score} out of ${maxQuestions}, ${playerName}.`;
      closeQuiz();
      return;
    }
    spinBtn.disabled = true;
    spinBtn.setAttribute('aria-disabled', 'true');
    playAgainBtn.style.display = 'none';
    newPlayerBtn.style.display = 'none';
    resultDiv.textContent = '';
    spinAngleStart = Math.random() * 10 + 10;
    spinTime = 0;
    spinTimeTotal = Math.random() * 3000 + 4000;
    rotateWheel();
  }

  function rotateWheel() {
    spinTime += 30;
    if(spinTime >= spinTimeTotal) {
      stopRotateWheel();
      return;
    }
    const spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
    startAngle += (spinAngle * Math.PI / 180);
    drawWheel();
    spinTimeout = setTimeout(rotateWheel, 30);
  }

  // Stop & select unasked question
  function stopRotateWheel() {
    clearTimeout(spinTimeout);
    const degrees = startAngle * 180 / Math.PI + 90;
    const arcd = arc * 180 / Math.PI;
    let index = Math.floor((360 - (degrees % 360)) / arcd);
    if(index >= numSegments) index = 0;

    // Find unasked question
    if(questionsAsked.has(index)) {
      for(let i=0; i<numSegments; i++) {
        if(!questionsAsked.has(i)) {
          index = i;
          break;
        }
      }
      if(questionsAsked.has(index)) {
        alert(`You answered all ${maxQuestions} questions! Thanks, ${playerName}.`);
        spinBtn.disabled = true;
        spinBtn.setAttribute('aria-disabled', 'true');
        playAgainBtn.style.display = 'inline-block';
        newPlayerBtn.style.display = 'inline-block';
        resultDiv.textContent = `Game over! You scored ${score} out of ${maxQuestions}, ${playerName}.`;
        closeQuiz();
        return;
      }
    }

    const segment = segments[index];
    questionsAsked.add(index);
    questionsCount++;
    resultDiv.textContent = `${playerName}, you got: ${segment.name}!`;

    showQuiz(segment.question, questionsCount, maxQuestions);
  }

  // --- Quiz modal ---
  function showQuiz(questionObj, current, total) {
    quizProgressDiv.textContent = `Question ${current} of ${total}`;
    quizQuestionDiv.textContent = questionObj.q;
    quizOptionsDiv.innerHTML = '';
    quizFeedbackDiv.textContent = '';
    quizModal.style.display = 'block';
    quizModal.setAttribute('aria-hidden', 'false');
    quizModal.querySelector('.modal-content').focus();

    questionObj.options.forEach((option, idx) => {
      const btn = document.createElement('button');
      btn.textContent = option;
      btn.setAttribute('type', 'button');
      btn.addEventListener('click', () => {
        if(idx === questionObj.answer) {
          quizFeedbackDiv.style.color = '#7CFC00';
          quizFeedbackDiv.textContent = 'Correct! 🎉';
          quizOptionsDiv.querySelectorAll('button').forEach(b => b.disabled = true);
          playAgainBtn.style.display = (questionsAsked.size >= maxQuestions) ? 'inline-block' : 'none';
          newPlayerBtn.style.display = (questionsAsked.size >= maxQuestions) ? 'inline-block' : 'none';
          incrementScore();
          if(questionsAsked.size === maxQuestions) {
            closeQuizBtn.textContent = 'Finish';
          }
        } else {
          quizFeedbackDiv.style.color = '#ff5555';
          quizFeedbackDiv.textContent = 'Incorrect, try again!';
          btn.disabled = true;
        }
      });
      quizOptionsDiv.appendChild(btn);
    });
  }

  closeQuizBtn.addEventListener('click', () => {
    closeQuiz();
    if(questionsAsked.size < maxQuestions) {
      spinBtn.disabled = false;
      spinBtn.setAttribute('aria-disabled', 'false');
      spinBtn.focus();
    } else {
      resultDiv.textContent = `Game over! You scored ${score} out of ${maxQuestions}, ${playerName}. Thanks for playing!`;
      spinBtn.disabled = true;
      spinBtn.setAttribute('aria-disabled', 'true');
      playAgainBtn.style.display = 'inline-block';
      newPlayerBtn.style.display = 'inline-block';
    }
  });

  function closeQuiz() {
    quizModal.style.display = 'none';
    quizModal.setAttribute('aria-hidden', 'true');
    quizFeedbackDiv.textContent = '';
  }

  // --- Score ---
  function incrementScore() {
    score++;
    scoreSpan.textContent = score;
  }

  // --- Name modal ---
  function enableSpinForName(name) {
    playerName = name.trim();
    localStorage.setItem('agilePlayerName', playerName);
    resetGame();
    resultDiv.textContent = `Hello, ${playerName}! Ready to spin the wheel?`;
    nameModal.style.display = 'none';
    spinBtn.disabled = false;
    spinBtn.setAttribute('aria-disabled', 'false');
    spinBtn.focus();
  }

  nameSubmitBtn.addEventListener('click', () => {
    const val = nameInput.value;
    if(val && val.trim().length > 0) {
      enableSpinForName(val);
    } else {
      alert('Please enter your name to continue.');
      nameInput.focus();
    }
  });

  // --- Reset game for new player or replay ---
  function resetGame() {
    questionsAsked.clear();
    questionsCount = 0;
    score = 0;
    scoreSpan.textContent = score;
    resultDiv.textContent = '';
    playAgainBtn.style.display = 'none';
    newPlayerBtn.style.display = 'none';
    spinBtn.disabled = false;
    spinBtn.setAttribute('aria-disabled', 'false');
    drawWheel();
  }

  // New player button click handler
  newPlayerBtn.addEventListener('click', () => {
    // Clear current player
    localStorage.removeItem('agilePlayerName');
    playerName = '';
    resetGame();
    nameInput.value = '';
    nameModal.style.display = 'block';
    spinBtn.disabled = true;
    spinBtn.setAttribute('aria-disabled', 'true');
    resultDiv.textContent = '';
    playAgainBtn.style.display = 'none';
    newPlayerBtn.style.display = 'none';
    nameInput.focus();
  });

  // --- Initialize ---
  drawWheel();

  if(playerName && playerName.length > 0) {
    resultDiv.textContent = `Welcome back, ${playerName}! Ready to spin the wheel?`;
    nameModal.style.display = 'none';
    spinBtn.disabled = false;
    spinBtn.setAttribute('aria-disabled', 'false');
  } else {
    nameModal.style.display = 'block';
    spinBtn.disabled = true;
    spinBtn.setAttribute('aria-disabled', 'true');
    nameInput.focus();
  }

  // Events
  spinBtn.addEventListener('click', spin);
  playAgainBtn.addEventListener('click', () => {
    resetGame();
    resultDiv.textContent = `Ready to spin again, ${playerName}?`;
  });

  // Accessibility: close quiz modal
  window.addEventListener('click', e => {
    if (e.target === quizModal) {
      closeQuiz();
      if(questionsAsked.size < maxQuestions) {
        spinBtn.disabled = false;
        spinBtn.setAttribute('aria-disabled', 'false');
      }
    }
  });
  
  window.addEventListener('keydown', e => {
    if (e.key === 'Escape' && quizModal.style.display === 'block') {
      closeQuiz();
      if(questionsAsked.size < maxQuestions) {
        spinBtn.disabled = false;
        spinBtn.setAttribute('aria-disabled', 'false');
      }
    }
  });
</script>

</body>
</html>
