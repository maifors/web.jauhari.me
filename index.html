<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Agile Game Hub - Choose Your Game</title>
<style>
  /* Ensure all styles are included here */
  /* Example: .modal { background-color: #fff; border-radius: 5px; } */
</style>
</head>
<body>

<header>
  <h1>Agile Game Hub</h1>
</header>

<main>
  <!-- Name Input Modal -->
  <div id="name-modal" class="modal" aria-modal="true" role="dialog" aria-labelledby="name-modal-title" aria-hidden="false" style="display: block;">
    <div class="modal-content" tabindex="0" style="max-width: 400px; margin: 10% auto;">
      <h2 id="name-modal-title">Welcome! Please enter your name</h2>
      <input type="text" id="player-name-input" placeholder="Your name here" aria-label="Player Name" autocomplete="off" />
      <button id="name-submit-btn">Start Playing</button>
    </div>
  </div>

  <!-- Game Selection -->
  <section id="game-selection" aria-label="Select an agile game to play" style="display: none;">
    <h2>Select a game to play</h2>
    <button class="game-choice" data-game="spinWheel">üé° Spin Wheel Quiz</button>
    <button class="game-choice" data-game="kanbanQuiz">üìã Kanban Board Quiz</button>
    <button class="game-choice" data-game="userStoryQuiz">üß© User Story Quiz</button>
    <button class="game-choice" data-game="retroQuiz">üîÑ Retrospective Quiz</button>
    <button class="game-choice" data-game="valuesQuiz">üìñ Agile Values Quiz</button>
  </section>

  <!-- Spin Wheel game area -->
  <canvas id="wheel" width="500" height="500" role="img" aria-label="Spin wheel with Agile quiz topics" style="display: none;"></canvas>
  <button id="spin-btn" aria-live="polite" aria-disabled="true" disabled style="display: none;">Spin the Wheel!</button>
  <button id="play-again-btn" style="display: none;">Play Again</button>
  <button id="new-player-btn" style="display: none;">New Player</button>
  <div id="result" aria-live="polite" aria-atomic="true"></div>
  <div id="scoreboard" aria-live="polite" aria-atomic="true">Correct Answers: <span id="score">0</span></div>
  <div id="timer" aria-live="polite" aria-atomic="true"></div>
</main>

<!-- Quiz Modal -->
<div id="quiz-modal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="quiz-title" aria-modal="true" style="display: none;">
  <div class="modal-content" tabindex="0">
    <div class="progress" id="quiz-progress">Question 1 of 6</div>
    <div id="quiz-question" class="question" id="quiz-title"></div>
    <div class="options" id="quiz-options"></div>
    <div class="feedback" id="quiz-feedback" aria-live="assertive"></div>
    <button id="close-quiz-btn" aria-label="Close quiz modal">Close</button>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    let playerName = localStorage.getItem('agilePlayerName') || '';
    let score = 0;
    let questionsAsked = new Set();
    let questionsCount = 0;
    const maxQuestions = 6;
    const maxAttemptsPerQuestion = 2;
    let currentAttempts = 0;
    let currentQuestionIndex = null;
    let timerInterval = null;
    const totalTime = 60; // seconds
    let timeLeft = totalTime;
    let currentGame = null;

    const nameModal = document.getElementById('name-modal');
    const nameInput = document.getElementById('player-name-input');
    const nameSubmitBtn = document.getElementById('name-submit-btn');
    const gameSelection = document.getElementById('game-selection');

    const wheel = document.getElementById('wheel');
    const ctx = wheel.getContext('2d');
    let startAngle = 0;
    let spinTimeout = null;
    let spinAngleStart = 0;
    let spinTime = 0;
    let spinTimeTotal = 0;

    const spinBtn = document.getElementById('spin-btn');
    const playAgainBtn = document.getElementById('play-again-btn');
    const newPlayerBtn = document.getElementById('new-player-btn');
    const resultDiv = document.getElementById('result');
    const scoreSpan = document.getElementById('score');
    const timerDiv = document.getElementById('timer');

    const quizModal = document.getElementById('quiz-modal');
    const quizProgressDiv = document.getElementById('quiz-progress');
    const quizQuestionDiv = document.getElementById('quiz-question');
    const quizOptionsDiv = document.getElementById('quiz-options');
    const quizFeedbackDiv = document.getElementById('quiz-feedback');
    const closeQuizBtn = document.getElementById('close-quiz-btn');

    const gameButtons = Array.from(document.querySelectorAll('.game-choice'));

    const games = {
      spinWheel: {
        name: "Spin Wheel Quiz",
        questions: [
          { q: 'Who is responsible for maximizing the value of the product in Scrum?', options: ['Scrum Master', 'Product Owner', 'Development Team', 'Stakeholders'], answer: 1 },
          { q: 'What does WIP stand for in Kanban?', options: ['Work In Progress', 'Work Is Planned', 'Workflow In Process', 'Work Item Priority'], answer: 0 },
          { q: 'Which is NOT one of the Agile Manifesto values?', options: ['Individuals and interactions over processes and tools', 'Working software over comprehensive documentation', 'Contract negotiation over customer collaboration', 'Responding to change over following a plan'], answer: 2 },
          { q: 'What is the main purpose of a Sprint Retrospective?', options: ['Plan the next sprint', 'Review the product', 'Inspect and adapt the process', 'Assign new tasks'], answer: 2 },
          { q: 'What is the typical format of a user story?', options: ['As a [role], I want [feature] so that [benefit]', 'When [event], then [result]', 'Given [context], when [event], then [outcome]', 'If [condition], then [action]'], answer: 0 },
          { q: 'What is a common Agile planning artifact?', options: ['Product Backlog', 'Gantt Chart', 'Critical Path', 'Waterfall Model'], answer: 0 },
        ]
      },
      kanbanQuiz: {
        name: "Kanban Board Quiz",
        questions: [
          { q: 'What color is usually associated with ‚ÄúBlocked‚Äù in Kanban?', options: ['Red', 'Green', 'Blue', 'Yellow'], answer: 0 },
          { q: 'What is the primary purpose of a Kanban board?', options: ['Track workflow', 'Plan sprints', 'Define roles', 'Estimate tasks'], answer: 0 },
          { q: 'What does ‚ÄúCumulative Flow Diagram‚Äù help visualize?', options: ['Task distribution', 'Cycle time', 'Workflow stability', 'User stories'], answer: 2 },
          { q: 'Which of these is a WIP limit benefit?', options: ['Faster delivery', 'More multitasking', 'Team confusion', 'Longer sprints'], answer: 0 },
          { q: 'Kanban originated from which industry?', options: ['Software', 'Manufacturing', 'Healthcare', 'Education'], answer: 1 },
          { q: 'What is the first step in implementing Kanban?', options: ['Visualize workflow', 'Plan sprints', 'Assign roles', 'Set deadlines'], answer: 0 },
        ]
      },
      userStoryQuiz: {
        name: "User Story Quiz",
        questions: [
          { q: 'What is the standard user story format?', options: ['As a [role], I want [feature] so that [benefit]', 'If [condition], then [action]', 'Given [context], when [event], then [outcome]', 'When [event], then [result]'], answer: 0 },
          { q: 'User stories are usually written by?', options: ['Developers', 'Product Owners', 'Testers', 'Stakeholders'], answer: 1 },
          { q: 'Which is a good characteristic of a user story?', options: ['Independent', 'Big', 'Ambiguous', 'Unclear'], answer: 0 },
          { q: 'User stories are stored in?', options: ['Product Backlog', 'Sprint Backlog', 'Kanban Board', 'Release Notes'], answer: 0 },
          { q: 'What does INVEST stand for?', options: ['Independent, Negotiable, Valuable, Estimable, Small, Testable', 'Innovative, Novel, Valuable, Efficient, Simple, Tested'], answer: 0 },
          { q: 'Who prioritizes user stories?', options: ['Scrum Master', 'Product Owner', 'Developers', 'Testers'], answer: 1 },
        ]
      },
      retroQuiz: {
        name: "Retrospective Quiz",
        questions: [
          { q: 'What is the main goal of a retrospective?', options: ['Inspect and adapt process', 'Plan next sprint', 'Discuss product features', 'Assign tasks'], answer: 0 },
          { q: 'Which of these is a common retro format?', options: ['Start, Stop, Continue', 'Waterfall', 'Gantt Chart', 'Kanban Board'], answer: 0 },
          { q: 'Retrospectives should happen?', options: ['After each sprint', 'Once a year', 'At project start', 'Daily'], answer: 0 },
          { q: 'Which role facilitates retros?', options: ['Development Team', 'Scrum Master', 'Product Owner', 'Stakeholders'], answer: 1 },
          { q: 'Retrospectives promote?', options: ['Continuous improvement', 'New requirements', 'Budget cuts', 'Deadline changes'], answer: 0 },
          { q: 'A ‚ÄúLean Coffee‚Äù is?', options: ['An informal retro format', 'A sprint ceremony', 'A coding practice', 'A testing method'], answer: 0 },
        ]
      },
      valuesQuiz: {
        name: "Agile Values Quiz",
        questions: [
          { q: 'One Agile value is?', options: ['Individuals and interactions over processes and tools', 'Following a plan over responding to change', 'Contract negotiation over customer collaboration', 'Comprehensive documentation over working software'], answer: 0 },
          { q: 'Agile manifesto values emphasize?', options: ['Flexibility', 'Strict rules', 'Heavy documentation', 'Fixed scope'], answer: 0 },
          { q: 'Which is NOT an Agile principle?', options: ['Customer collaboration', 'Responding to change', 'Working software', 'Ignoring feedback'], answer: 3 },
          { q: 'Agile promotes?', options: ['Continuous delivery', 'Waterfall phases', 'Delayed testing', 'Fixed contracts'], answer: 0 },
          { q: 'Agile team sizes usually are?', options: ['Small and cross-functional', 'Large and hierarchical', 'Single developer', 'Only managers'], answer: 0 },
          { q: 'Agile encourages?', options: ['Face-to-face communication', 'Emails only', 'Avoiding meetings', 'No documentation'], answer: 0 },
        ]
      }
    };

    let currentQuestions = [];
    let currentSegments = [];

    const arc = 2 * Math.PI / maxQuestions; // 6 segments

    function drawWheelSegments() {
      const centerX = wheel.width / 2;
      const centerY = wheel.height / 2;
      const radius = Math.min(centerX, centerY) - 10;

      ctx.clearRect(0, 0, wheel.width, wheel.height);
      for(let i = 0; i < currentSegments.length; i++) {
        let angle = startAngle + i * arc;
        ctx.fillStyle = currentSegments[i].color;
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, angle, angle + arc, false);
        ctx.lineTo(centerX, centerY);
        ctx.fill();

        ctx.save();
        ctx.fillStyle = 'white';
        ctx.font = 'bold 16px Arial';
        ctx.translate(centerX + Math.cos(angle + arc/2) * radius / 1.5,
                      centerY + Math.sin(angle + arc/2) * radius / 1.5);
        ctx.rotate(angle + arc/2 + Math.PI/2);
        ctx.fillText(currentSegments[i].name || "Question", -ctx.measureText(currentSegments[i].name).width / 2, 0);
        ctx.restore();
      }
      ctx.beginPath();
      ctx.arc(centerX, centerY, 50, 0, 2 * Math.PI);
      ctx.fillStyle = '#16213e';
      ctx.fill();

      ctx.fillStyle = '#e94560';
      ctx.beginPath();
      ctx.moveTo(centerX - 15, centerY - (radius + 10));
      ctx.lineTo(centerX + 15, centerY - (radius + 10));
      ctx.lineTo(centerX, centerY - (radius - 10));
      ctx.closePath();
      ctx.fill();
    }

    function initialize() {
      if(playerName && playerName.length > 0) {
        nameModal.style.display = 'none';
        gameSelection.style.display = 'block';
        wheel.style.display = 'none';
        spinBtn.style.display = 'none';
        playAgainBtn.style.display = 'none';
        newPlayerBtn.style.display = 'none';
        timerDiv.textContent = '';
        resultDiv.textContent = '';
      } else {
        nameModal.style.display = 'block';
        gameSelection.style.display = 'none';
        wheel.style.display = 'none';
        spinBtn.style.display = 'none';
        playAgainBtn.style.display = 'none';
        newPlayerBtn.style.display = 'none';
        timerDiv.textContent = '';
        resultDiv.textContent = '';
      }
    }

    function setupGame(gameKey) {
      currentGame = gameKey;
      currentQuestions = games[gameKey].questions.slice(0, maxQuestions);
      currentSegments = currentQuestions.map((q,i) => ({
        name: games[gameKey].name + ` Q${i+1}`,
        color: ['#FF6384','#36A2EB','#FFCE56','#9966FF','#FF9F40','#4BC0C0'][i % 6]
      }));

      resetGame();

      gameSelection.style.display = 'none';
      resultDiv.textContent = `Hello, ${playerName}! Ready to play ${games[gameKey].name}?`;
      scoreSpan.textContent = '0';
      timerDiv.textContent = `Time left: ${totalTime}s`;

      if(gameKey === 'spinWheel') {
        wheel.style.display = 'block';
        spinBtn.style.display = 'inline-block';
      } else {
        wheel.style.display = 'none';
        spinBtn.style.display = 'none';
        currentQuestionIndex = 0;
        questionsAsked.add(0);
        questionsCount = 1;
        currentAttempts = 0;
        showQuiz(currentQuestions[0], 1, maxQuestions);
        startTimer();
      }

      playAgainBtn.style.display = 'none';
      newPlayerBtn.style.display = 'none';

      if(gameKey === 'spinWheel'){
        drawWheelSegments();
        spinBtn.disabled = false;
        spinBtn.setAttribute('aria-disabled', 'false');
      }
    }

    nameSubmitBtn.addEventListener('click', () => {
      const val = nameInput.value;
      if(val && val.trim().length > 0) {
        playerName = val.trim();
        localStorage.setItem('agilePlayerName', playerName);
        initialize();
      } else {
        alert('Please enter your name to continue.');
        nameInput.focus();
      }
    });

    gameButtons.forEach(btn => btn.addEventListener('click', () => setupGame(btn.getAttribute('data-game'))));

    newPlayerBtn.addEventListener('click', () => {
      localStorage.removeItem('agilePlayerName');
      playerName = '';
      resetGame();
      nameInput.value = '';
      initialize();
      nameInput.focus();
    });

    spinBtn.addEventListener('click', () => {
      if(currentGame === 'spinWheel') {
        spin();
      }
    });

    playAgainBtn.addEventListener('click', () => {
      resetGame();
      resultDiv.textContent = `Ready to play again, ${playerName}?`;
    });

    closeQuizBtn.addEventListener('click', () => {
      closeQuiz();
      if(questionsAsked.size < maxQuestions && timeLeft > 0) {
        if(currentGame === 'spinWheel') {
          spinBtn.disabled = false;
          spinBtn.setAttribute('aria-disabled', 'false');
          spinBtn.focus();
        } else {
          nextNonSpinQuestion();
        }
      } else {
        resultDiv.textContent = `Game over! You scored ${score} out of ${maxQuestions}, ${playerName}. Thanks for playing!`;
        spinBtn.disabled = true;
        spinBtn.setAttribute('aria-disabled', 'true');
        playAgainBtn.style.display = 'inline-block';
        newPlayerBtn.style.display = 'inline-block';
        stopTimer();
      }
    });

    initialize();
  });
</script>

</body>
</html>
